= 生产方块与电力方块 =

这一节把“资源从哪里来、能量怎么供”讲清楚。生产方块负责把地板资源或输入材料变成可用产出；电力方块负责发电、传输和存储。JSON 可以完整配置字段，但具体工作逻辑仍以 Java 实现为准，所以看到字段时要理解它们在运行时的含义。

== 钻头与开采逻辑 ==

<code>Drill</code> 是最常见的钻头类型，像“机械钻头”“气动钻头”“激光钻头”“爆破钻头”这一条线都属于它。钻头的核心逻辑是“确定主矿 → 累积进度 → 产出并尝试卸载”。当钻头覆盖多个矿物时，它会统计占地范围内每种矿物的数量，选出“主矿”，并把该矿的数量记为 <code>dominantItems</code>。这个数量会被乘入速度计算，所以 2x2、3x3 钻头在不同地形上实际产速会不同。

钻速由 <code>drillTime</code>、<code>hardnessDrillMultiplier</code> 和 <code>drillMultipliers</code> 决定。<code>drillTime</code> 是“基础挖出一个物品所需的刻数”，<code>hardnessDrillMultiplier</code> 把矿物硬度叠加到耗时上，<code>drillMultipliers</code> 则是“按物品类型的速度倍率”。它们一起决定单个物品的基础耗时：

<pre>( drillTime + hardnessDrillMultiplier * 物品硬度 ) / drillMultipliers[item]</pre>
<code>tier</code> 决定最大可采硬度，<code>blockedItem</code>/<code>blockedItems</code> 可以禁采指定物品。如果主矿硬度超过 <code>tier</code> 或在禁采列表里，<code>dominantItem</code> 会为空，钻头就不会工作。<code>itemCapacity</code> 决定内部缓冲容量，<code>items.total()</code> 满了就会停机，即使外部传送带仍有空间也不会继续挖。钻头会定期尝试 <code>dump()</code> 把主矿卸到相邻建筑或传送带上，所以传送带堵住时你会看到钻头“停在满格”。

液体加速由 <code>liquidBoostIntensity</code> 与消耗器上的 <code>booster</code> 配合决定。如果你在 <code>consumes</code> 里写了液体消耗器并标记为 <code>booster</code>，钻头会按 <code>optionalEfficiency</code> 把速度从 1 线性插值到 <code>liquidBoostIntensity</code>。若再配合 <code>optional: true</code>，就能做到“没有液体也能挖，但更慢”的效果。这个机制非常适合做“可选加速”而不是“必须液体”。

<code>BurstDrill</code> 是“爆发式钻头”，它依然继承 <code>Drill</code>，但把 <code>hardnessDrillMultiplier</code> 设为 0 并使用独立的速度曲线，所以硬度不再影响速度，进度会呈现“蓄力→爆发”的节奏。<code>BeamDrill</code> 用于挖墙体矿，例如“等离子钻机”“大型等离子钻机”就是这一类；其关键字段是 <code>range</code>、<code>tier</code>、<code>drillTime</code> 与 <code>optionalBoostIntensity</code>。<code>WallCrafter</code> 则是“凿墙机”，兼具钻头输出与属性加成，适合做“固定产出”的墙体采集方块。

为了帮助你理解硬度梯度，这里给出原版的粗略对照（仅用于理解关系，实际数值以原版为准）：

{|
!align="center" width="25%"| 资源
!align="center" width="25%"| 钻头
!align="center" width="25%"| 矿机
!align="center" width="25%"| 硬度
|-
|align="center"| “沙”、“废料”、“石墨”
|align="center"|
|align="center"|
|align="center"| 0
|-
|align="center"| “铜”、“铅”
|align="center"|
|align="center"| “独影”、“阿尔法”、“贝塔”
|align="center"| 1
|-
|align="center"| “煤炭”
|align="center"| “机械钻头”
|align="center"| “恒星”、“幻型”、“伽马”
|align="center"| 2
|-
|align="center"| “钛”、“铍”
|align="center"| “气动钻头”、“等离子钻机”
|align="center"| “耀星”、“巨像”、“苏醒”、“策动”、“发散”
|align="center"| 3
|-
|align="center"| “钍”
|align="center"| “激光钻头”
|align="center"|
|align="center"| 4
|-
|align="center"| “钨”
|align="center"| “爆破钻头”、“大型等离子钻机”
|align="center"|
|align="center"| 5
|-
|align="center"|
|align="center"| “冲击钻头”
|align="center"|
|align="center"| 6
|-
|align="center"|
|align="center"| “爆裂钻头”
|align="center"|
|align="center"| 7
|}

下面是一个最小的钻头示例。它使用 <code>Drill</code> 类型，设置 <code>tier</code> 与 <code>drillTime</code>，并通过 <code>consumes.liquid</code> 让“水”作为加速液体使用：

'''文件：content/blocks/tutorial-drill.json'''

<pre>{
    "type": "Drill",
    "name": "示例钻头",
    "description": "慢速钻头，用于演示。",
    "size": 2,
    "tier": 2,
    "drillTime": 300,
    "liquidBoostIntensity": 1.6,
    "requirements": [
        "copper/50",
        "lead/30"
    ],
    "consumes": {
        "liquid": {
            "liquid": "water",
            "amount": 0.05,
            "booster": true
        }
    }
}
</pre>
这个例子中，<code>drillTime</code> 决定基础耗时，<code>tier</code> 决定可采硬度，<code>liquidBoostIntensity</code> 与 <code>booster</code> 组合决定加速效果。实际速度还会受到被采矿物硬度与 <code>drillMultipliers</code> 的影响。

钻头贴图方面，多数钻头需要三张贴图：<code>-rotator</code>、<code>-top</code>、本体。额外效果（如光环、物品显示）会要求 <code>-rim</code> 或 <code>-item</code>。贴图命名规则与 Java 教程一致，建议先复刻原版的贴图结构再做改动。

钻头还有一组更偏“表现”的字段。<code>drillEffect</code> 会在产出物品时触发，<code>updateEffect</code>/<code>updateEffectChance</code> 控制运转时的粒子与频率，<code>rotateSpeed</code> 与 <code>warmupSpeed</code> 只影响动画速率，不直接改变真实产量。这些字段的意义是“让玩家感受到强度差异”，尤其是高阶钻头，哪怕数值已经很快了，如果缺少足够的视觉节奏，也会显得“像普通钻头”。

<span id="模组示例饱和火力-3.3.0-的钻头"></span>
== 模组示例：饱和火力 3.3.0 的钻头 ==

“饱和火力 3.3.0”里的“离子钻头”是一个很典型的“高阶钻头”示例。它把 <code>hardnessDrillMultiplier</code> 拉低、<code>drillTime</code> 拉短，同时用 <code>consumes.liquid</code> 配置了可选加速液体。你可以看到它把液体消耗写成对象，并开启了 <code>optional</code> 与 <code>booster</code>，这意味着没水也能挖，有水更快：

<pre>{
    "type": "Drill",
    "name": "离子钻头",
    "size": 3,
    "tier": 8,
    "drillTime": 50,
    "hardnessDrillMultiplier": 40,
    "liquidBoostIntensity": 1.6,
    "consumes": {
        "power": 3,
        "liquid": {
            "liquid": "water",
            "amount": 0.11,
            "booster": true,
            "optional": true
        }
    }
}</pre>
这个片段能很好地说明“可选加速”的写法。如果你希望玩家在早期也能用钻头，但在中后期通过管网提升效率，这种配置非常合适。

== 泵与液体产出 ==

泵类方块负责把液体“从地板抽进管网”。<code>Pump</code> 直接读取地板的 <code>liquidDrop</code>，适合放在“水”“矿渣”等液体地面上。<code>SolidPump</code> 则是在固态地板上“产出”指定液体，对应原版的“抽水机”。<code>Fracker</code> 对应原版“石油钻井”，本质上是 <code>SolidPump</code> 的子类，但增加了物品消耗与 <code>itemUseTime</code>，即“每消耗一次物品，可维持产出一段时间”。

泵的关键字段通常是 <code>pumpAmount</code>（每刻抽取量）、<code>result</code>（输出的液体类型）、<code>attribute</code> 与 <code>baseEfficiency</code>（属性加成与基础效率）。如果泵需要物品或电力，仍然通过 <code>consumes</code> 来配置。地板本身也会影响泵的产出，例如液体地板的 <code>liquidMultiplier</code> 会影响抽取量，深水地面通常比浅水更高效。

'''文件：content/blocks/tutorial-solid-pump.json'''

<pre>{
    "type": "SolidPump",
    "name": "示例抽水机",
    "description": "在固态地面产出水。",
    "size": 2,
    "result": "water",
    "pumpAmount": 0.12,
    "requirements": [
        "copper/60",
        "lead/40"
    ],
    "consumes": {
        "power": 1.1
    }
}
</pre>
这个例子里，<code>pumpAmount</code> 是每刻产液量，<code>result</code> 指向产出的液体，<code>consumes.power</code> 让它成为用电设备。若你想让地形属性影响效率，给 <code>attribute</code> 与 <code>baseEfficiency</code> 赋值即可。

<span id="模组示例饱和火力-3.3.0-的泵"></span>
== 模组示例：饱和火力 3.3.0 的泵 ==

“潮汐泵”是一个典型的高吞吐液体泵。它把 <code>pumpAmount</code> 设得很高，并给了极大的 <code>liquidCapacity</code>，适合做“集中供液”节点。它还使用了自定义 <code>DrawMulti</code> 绘制器来叠加液体与本体，体现了“产量大但体积也大”的定位。

<pre>{
    "type": "Pump",
    "name": "潮汐泵",
    "size": 4,
    "liquidCapacity": 800,
    "pumpAmount": 1,
    "consumes": {
        "power": 12
    }
}</pre>
这个片段的关键是 <code>liquidCapacity</code> 与 <code>pumpAmount</code> 的组合。前者决定缓冲，后者决定流量，若你只提升流量却不提升容量，泵会更容易“满溢停机”。

高吞吐泵还有一个常见误区：<code>pumpAmount</code> 增长得太快，而 <code>liquidCapacity</code> 和管网带宽跟不上，会导致“满了就停、停了就满”的节奏抖动，实际平均流量反而不高。设计时最好把“泵本体容量”和“管道最大流量”一并考虑，避免玩家在布局上被迫堆很多缓冲罐来补救。

<span id="模组示例饱和火力-3.3.0-的石油深井"></span>
== 模组示例：饱和火力 3.3.0 的石油深井 ==

“石油深井”使用 <code>SolidPump</code> 并明确指定了 <code>attribute</code> 和 <code>baseEfficiency</code>，用来强调“地形属性决定效率”的机制。它在含油属性的地形上更高效，而在普通地面上仍能维持一定产出：

<pre>{
    "type": "SolidPump",
    "name": "石油深井",
    "pumpAmount": 0.201,
    "result": "oil",
    "attribute": "oil",
    "baseEfficiency": 0.75,
    "consumes": {
        "power": 6.5
    }
}</pre>
这个配置能直观体现“选址”的价值：地形好坏并不会决定能不能用，而是决定“值不值得用”。这也是生产方块平衡里最常见的设计思路之一。

== 属性系统与效率 ==

属性（<code>Attribute</code>）是生产方块的重要基础机制。它用于描述地形对生产效率的影响，例如“热能”属性影响“热能发电机”，水属性影响某些生产方块。<code>AttributeCrafter</code>、<code>SolidPump</code>、<code>ThermalGenerator</code> 等方块都会读取 <code>attribute</code> 与 <code>baseEfficiency</code> 来计算最终效率。若 <code>baseEfficiency</code> 为 0，方块几乎完全依赖属性；若 <code>baseEfficiency</code> 较高，则地形只起到加成作用。这个机制常用于做“特定地形更高效”的方块，也用于提醒玩家选址。

== 电力系统与发电逻辑 ==

电力系统由发电、传输、存储三部分构成。发电方块大多继承自 <code>PowerGenerator</code>，核心字段是 <code>powerProduction</code>。实际发电量会乘以 <code>productionEfficiency</code>，而效率会受到输入不足、环境属性不足等因素影响。<code>ConsumeGenerator</code> 是最常见的消耗型发电机，它用 <code>itemDuration</code> 表示“一个物品能维持多少刻的发电”。因此 <code>itemDuration</code> 越大，单个燃料持续时间越长，发电越稳定。

<code>itemFlammable</code>、<code>itemExplosive</code>、<code>itemRadioactive</code> 等筛选消耗器会根据物品属性自动评估效率。例如“火力发电机”会偏好高可燃性物品，“RTG 发电机”则看重放射性。<code>itemDurationMultipliers</code> 可以对某些物品做额外倍率调整，适合做“特殊燃料”。<code>ConsumeGenerator</code> 还支持 <code>outputLiquid</code> 与 <code>explodeOnFull</code>，可以在发电的同时产出液体，或者在液体堆满时爆炸（比如用来模拟高压风险）。

如果你希望发电机“有副产物”，<code>outputLiquid</code> 是最直接的做法。它会把液体写进发电机的内部储罐，并像普通液体方块一样尝试向外输出。当外部管网堵塞，发电机会因为液体满而降效甚至停机，这点和生产方块的“物品缓冲”非常相似。设计时要么加大 <code>liquidCapacity</code> 来缓冲，要么把 <code>outputLiquid</code> 设得较小，以免发电机在战斗或波次高峰时因为管网挤压而掉电。

“热能发电机”属于 <code>ThermalGenerator</code>，它会读取地板属性（默认是热量）并计算 <code>productionEfficiency</code>。<code>minEfficiency</code> 控制最低可放置要求，<code>displayEfficiency</code> 与 <code>displayEfficiencyScale</code> 决定建造时显示的效率文本。类似的还有“太阳能板”（<code>SolarGenerator</code>），它的输出会受到光照强度影响。

电网传输依赖 <code>PowerNode</code> 系列方块，<code>laserRange</code> 决定连接范围，<code>maxNodes</code> 决定最多能连多少个节点，<code>autolink</code> 控制是否自动连线。存储则由 <code>Battery</code> 系列方块承担，<code>powerCapacity</code> 决定储能上限。原版中常见的例子包括“电力节点”“大型电力节点”“电池”“大型电池”。如果你发现发电充足但设备仍提示缺电，多半是电网断开或储能不足导致的能量“波动”。

<span id="模组示例饱和火力-3.3.0-的发电机"></span>
== 模组示例：饱和火力 3.3.0 的发电机 ==

“增压励磁发电站”使用了 <code>ConsumeGenerator</code> 并同时消耗可燃物与液体。它把 <code>itemDuration</code> 设得很短，强调高频消耗、高峰值输出，并通过 <code>DrawMulti</code> 叠加多个旋转贴图来表现高速运转。下面是其核心字段节选：

<pre>{
    "type": "ConsumeGenerator",
    "name": "增压励磁发电站",
    "size": 3,
    "itemDuration": 15,
    "powerProduction": 38.5,
    "consumes": {
        "itemFlammable": {},
        "itemExplode": {},
        "liquid": "water/0.6"
    }
}</pre>
这个例子展示了“多种筛选消耗器 + 液体输入”的组合。对于想做“高风险高收益”发电机的设计者来说，它提供了一个很好的参考模板。

<span id="模组示例饱和火力-3.3.0-的弧形裂变堆"></span>
== 模组示例：饱和火力 3.3.0 的弧形裂变堆 ==

“弧形裂变堆”展示了“高能燃料 + 高级液体”的组合思路。它使用 <code>itemRadioactive</code> 与 <code>itemExplode</code> 来筛选燃料，再用液体维持稳定输出，同时在 <code>drawer</code> 里用多层 <code>DrawArcSmelt</code> 叠加出高能反应的视觉效果：

<pre>{
    "type": "ConsumeGenerator",
    "name": "弧形裂变堆",
    "itemDuration": 19.5,
    "powerProduction": 550,
    "consumes": {
        "itemRadioactive": {},
        "itemExplode": {},
        "liquid": "纳米流体/0.9"
    },
    "generateEffect": "generatespark"
}</pre>
它的意义不是“又一个发电机”，而是提供“高风险燃料 + 高级液体”的经济消耗路线。如果你的模组有稀缺液体或高阶燃料，类似设计能让这些资源有明确的战略价值。

<span id="产量节奏与平衡的直觉"></span>
== 产量、节奏与平衡的直觉 ==

设计生产方块时，最容易忽略的是“节奏感”。<code>drillTime</code>、<code>itemDuration</code>、<code>craftTime</code> 等字段不仅决定效率，还决定玩家对这条生产线的体感节奏。比如“爆破钻头”和“冲击钻头”就属于明显“慢—快—慢”的节奏，这会迫使玩家建立更大的缓冲与运输。相反，像“机械钻头”这种稳定输出更适合做“基础供给”。当你为模组设计新钻头时，不妨先想清楚它要服务哪一类生产链，再决定输出节奏。

电力也有类似的节奏。<code>powerProduction</code> 的单位是“每刻发电量”，游戏面板会按每秒显示，因此一个 <code>powerProduction = 1</code> 的发电机，在面板上会看到 60 的发电速率。发电机与耗电设备之间的“峰值错位”往往来自储能不足，而不是发电不足。如果你的系统在启动时经常掉电，可能需要的是更多“电池”而不是更多发电机。

消耗型发电机的平衡点在于“燃料密度”。<code>itemDuration</code> 越长，单个物品的发电时间越久，但这也会让玩家更依赖高价值燃料；<code>itemDuration</code> 越短，发电更“灵敏”，但运输压力更大。你可以通过 <code>itemDurationMultipliers</code> 做“特殊燃料”，让某些物品成为“高能燃料”，同时保持普通燃料的基础效率，这样既能控制经济，又能让玩家有明确的升级目标。

属性型方块的平衡点在于“选址与收益”。如果 <code>baseEfficiency</code> 设得太高，属性加成就毫无意义，玩家也不会在意地形；如果设得太低，方块在非特定地形几乎无法使用，玩法会被强行限制。原版的“热能发电机”与“抽水机”就是典型案例，它们既鼓励选址，又不会完全“锁死”。

如果你在设计“高阶产物的生产链”，还可以把生产与发电绑定：例如某个工厂需要大量电力，但它的副产物恰好是发电燃料；或者某个发电机产生的液体正是下一步生产的冷却液。这样的闭环能让玩家觉得“体系在运转”，比单纯堆数值更有成就感。

== 小结 ==

生产链的稳定性来自三个因素：资源地形、输入补给与输出畅通。钻头与泵决定“资源是否稳定产出”，工厂决定“资源如何转化”，发电与传输决定“系统是否有能量”。理解这些字段在运行时的角色后，JSON 配置就不仅是“写参数”，而是“设计生产线”。
